import faker from 'faker';
import { CHECKOUT_LINK_DELIVERY_FEE } from 'src/common/contants';
import { Post } from 'src/posts/contracts';
import { v4 } from 'uuid';
import { TransactionPostbackBody } from '../../src/payments/contracts/dtos';
import { Address } from '../../src/users/contracts';

export function randomTransaction(
  email: string,
  userName: string,
  phoneNumber: string,
  address: Address,
  pagarmeOrderId: string,
): TransactionPostbackBody['transaction'] {
  return {
    object: 'transaction',
    status: 'paid',
    refuse_reason: '',
    status_reason: 'acquirer',
    acquirer_response_code: '0000',
    acquirer_name: 'pagarme',
    acquirer_id: '603fa3c295152c0011eb06af',
    authorization_code: '713929',
    soft_descriptor: '',
    tid: '14270255',
    nsu: '14270255',
    date_created: '2021-10-06T22:31:30.730Z',
    date_updated: '2021-10-06T22:31:31.109Z',
    amount: '1472',
    authorized_amount: '1472',
    paid_amount: '1472',
    refunded_amount: '0',
    installments: '1',
    id: '14270255',
    cost: '99',
    card_holder_name: userName,
    card_last_digits: '8884',
    card_first_digits: '555566',
    card_brand: 'mastercard',
    card_pin_mode: '',
    card_magstripe_fallback: 'false',
    cvm_pin: 'false',
    postback_url: 'http://2790-189-29-169-27.ngrok.io/pagarme-postbacks/transactions',
    payment_method: 'credit_card',
    capture_method: 'ecommerce',
    antifraud_score: '',
    boleto_url: '',
    boleto_barcode: '',
    boleto_expiration_date: '2021-10-26T03:00:00.000Z',
    referer: 'encryption_key',
    ip: faker.internet.ip(),
    subscription_id: '',
    phone: '',
    address: '',
    customer: {
      object: 'customer',
      id: '7056485',
      external_id: email,
      type: 'individual',
      country: 'br',
      document_number: '',
      document_type: 'cpf',
      name: userName,
      email: email,
      phone_numbers: [phoneNumber],
      born_at: '',
      birthday: '',
      gender: '',
      date_created: '2021-10-06T22:31:30.656Z',
      documents: [
        {
          object: 'document',
          id: 'doc_ckug355yi01xl0h9ta4yklgkw',
          type: 'cpf',
          number: '16041723045',
        },
      ],
    },
    billing: {
      object: 'billing',
      id: '3048972',
      name: userName,
      address: {
        object: 'address',
        street: address.street,
        complementary: address.complement,
        street_number: address.number.toString(),
        neighborhood: address.district,
        city: address.city,
        state: address.state,
        zipcode: address.zipCode,
        country: faker.address.country(),
        id: '5845721',
      },
    },
    shipping: '',
    card: {
      object: 'card',
      id: 'card_ckug3zy5l05ea0h9thxs6yb5u',
      date_created: '2021-10-06T22:55:26.889Z',
      date_updated: '2021-10-06T22:55:26.889Z',
      brand: 'mastercard',
      holder_name: userName,
      first_digits: '555566',
      last_digits: '8884',
      country: 'UNITED STATES',
      fingerprint: 'cjoq024sw1mxt0h72d5aflpep',
      valid: '',
      expiration_date: '1222',
    },
    split_rules: '',
    reference_key: '',
    device: { session: '885d0a8050ecc19575f28fbffd755c31665f8125' },
    local_transaction_id: '',
    local_time: '',
    fraud_covered: 'false',
    fraud_reimbursed: '',
    order_id: pagarmeOrderId,
    risk_level: 'very_low',
    receipt_url: '',
    payment: '',
    addition: '',
    discount: '',
    private_label: '',
    pix_qr_code: '',
    pix_expiration_date: '',
  };
}

export function randomOrder(post: Post) {
  return {
    object: 'order',
    id: v4(),
    company_id: '603fa3c295152c0011eb06ac',
    status: 'paid',
    amount: post.price + CHECKOUT_LINK_DELIVERY_FEE,
    items: [
      {
        object: 'item',
        id: post._id,
        title: post.title,
        unit_price: post.price,
        quantity: '1',
        category: '',
        tangible: 'true',
        venue: '',
        date: '',
      },
    ],
    payment_link_id: 'pl_ckug5h7st02x90h9teeewut0n',
    postback_url: 'http://localhost:3000/pagarme-postbacks/orders',
    date_created: '2021-10-06T23:36:59.661Z',
  };
}
